{% extends "account/base_entrance.html" %}
{% load allauth %}
{% load django_bootstrap5 %}
{% block title %}
    Email Addresses
{% endblock title %}
{% block content %}
    <div class="container">
        <h1>Email Addresses</h1>
        {% if emailaddresses %}
            <p>The following email addresses are associated with your account:</p>
            {% url 'account_email' as email_url %}
            {% element form form=form action=email_url method="post" tags="email,list" %}
                {% slot body %}
                    {% csrf_token %}
                    <div class="container mb-3 border border-2 rounded-4 p-3">
                        {% for radio in emailaddress_radios %}
                            {% with emailaddress=radio.emailaddress %}
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="email" id="{{radio.id}}" value="{{emailaddress.email}}" 
                                        {% if radio.checked == True %} checked {% endif %}
                                    >
                                    <label class="form-check-label" for="email">
                                        {{emailaddress.email}}
                                        <br>
                                        {% if emailaddress.verified %}
                                            {% element badge tags="success,email,verified" %}
                                                <span class="badge text-bg-success">Verified</span>
                                            {% endelement %}
                                        {% else %}
                                            {% element badge tags="warning,email,unverified" %}
                                                <span class="badge text-bg-danger">Unverified</span>
                                            {% endelement %}
                                        {% endif %}
                                        {% if emailaddress.primary %}
                                            {% element badge tags="email,primary" %}
                                                <span class="badge text-bg-primary">Primary</span>
                                            {% endelement %}
                                        {% endif %}
                                    </label>
                                </div>
                            {% endwith %}
                        {% endfor %}
                    </div>
                {% endslot %}
                {% slot actions %}
                    <button type="submit" name="action_primary" class="btn btn-primary">Make Primary</button>
                    <button type="submit" name="action_send" class="btn btn-warning">Re-send Verification</button>
                    <button type="submit" name="action_remove" class="btn btn-danger">Remove</button>
                {% endslot %}
            {% endelement %}
        {% else %}
            {% include "account/snippets/warn_no_email.html" %}
        {% endif %}
        {% if can_add_email %}
            <div class="container mt-3">
                <h2>Add Email Address</h2>
                {% url 'account_email' as action_url %}
                {% element form form=form method="post" action=action_url tags="email,add" %}
                    {% slot body %}
                        {% csrf_token %}
                        {% bootstrap_form form %}
                    {% endslot %}
                    {% slot actions %}
                        <button type="submit" name="action_add" class="btn btn-primary">Add Email</button>
                    {% endslot %}
                {% endelement %}
            </div>
        {% endif %}
    </div>
    <script type="text/javascript">
        (function() {
        var message = "Do you really want to remove the selected email address?";
        var actions = document.getElementsByName('action_remove');
        if (actions.length) {
            actions[0].addEventListener("click", function(e) {
            if (! confirm(message)) {
                e.preventDefault();
            }
            });
        }
        })();
    </script>
{% endblock content %}